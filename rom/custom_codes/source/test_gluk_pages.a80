
		include ../../macros.a80
		include ../../global_vars.a80

		ORG 0X6000
		DI
		LD E,0X3F
		LD A,0XF7
		CALL SET_PAGES
		LD A,0XD7
		CALL SET_PAGES
		LD BC,0X7FFD
		LD A,0X10
		OUT (C),A
		LD A,1
		OUT (PEVO_CONF),A
		CALL READ_NUM_PAGES
		LD BC,WIN_P2
		LD A,0XFD
		OUT (C),A
		XOR A
		OUT (PEVO_CONF),A
		JR $

SET_PAGES	LD BC,0X7FFD
		OUT (C),A
SETPAGES2	LD D,A
		LD A,E
		LD (0XC000),A
		DEC E
		LD A,D
		AND 0XC7
		RET Z
		AND 7
		LD A,D
		JR NZ,SETPAGES3
		SUB 0X38
SETPAGES3	DEC A
		JR SET_PAGES

READ_NUM_PAGES	LD HL,0X7000
		LD D,0XC0
		LD BC,WIN_P2
RDNUMPAGES1	OUT (C),D
		INC D
		RET Z
		LD A,(0X8000)
		LD (HL),A
		INC HL
		JR RDNUMPAGES1
