Магик на пентеве.


1. ВВодится состояние NMI. Отличается тем, что в очко #0000-#3FFF принудительно
включается последняя (255ая) страница ОЗУ.

Вход в состояние NMI происходит, собственно, по началу сигнала /NMI на
процессор.

При этом, вход не гарантируется и может привести к катастрофе, если /MNI
приходит во время команды, которая:
1) имеет стек области #0000-#3FFF
2) исполняется из области #0000-#3FFF
3) использует данные в области #0000-#3FFF
В случаях 1 и 3 может нарушиться целостность данных в последней странице ОЗУ.


2. предлагается ввести порт #BE (чтение-запись).

на чтение - можно будет считать состояние портов #7FFD, #EFF7, #xx77, состояние
менеджера памяти. Что читаем - определяется старшим адресным байтом. Конкретный
формат пока не определён.

что нужно считывать конкретно:

#7ffd, все биты.
#eff7, биты:
 4 - turbo
 0,5 - videomode
 2 - pent1m ena
 3 - 0000-3FFF ram0 on
 7 - gluck clock ena
 1,6 - хз что, но пусть будут тоже

#xxF7:
каждое очко в каждой карте памяти:
8бит номера паги
1бит ramnrom
1бит dos7ffd

всего 4 очка * 2 карты памяти

#xx77:
2:0 - видеомода
3 - атм турба
a14, a8, a9 - всякая пурга


Порт #BF сам по себе (рид-райт)




на запись - после факта записи в этот порт, если находимся в состоянии NMI, на
2ой по счёту /RFSH выключаем это состояние.

Таким образом выход из NMI происходит так

  POP <все регистры>
  OUT (#BE),A
  RETN

