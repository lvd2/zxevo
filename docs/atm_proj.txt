Буду тут думать об том, как атм модес впихать в пентеву.
Поначалу речь пойдёт об манагере памяти и всём что с ним связано.

рассмотрим атм2.
Там применён оригинальный манагер памяти 1м, который позволяет флипать любую из 16к очек процессора.
Для совместимости с 128к моде было сделано следующее.
1 - добавлены 2 карты памяти, переключаемые с помощью бита из 7ффд, который раньше переключал пзухи
2 - сделан режим, когда младшие 3 бита номера страницы в данном очке могут подменяться на д0-д2 из 7ффд.
При помощи такой хуебени эмулируется обычная карта памяти 128к спека.
Сильная залочка на ДОСЕН и гадское трдос - я не понял например, можно ли без постоянной дрочки
ДОСЕН- не ДОСЕН вклчать любую страничку ПЗУ и работать с ней.

что требуется
1 - поддержать режим атм-компатибилити.
2 - расширить адресацию страниц озу до 4 метров
3 - интегрировать режим п1024к в атмо-режимы.



Волевые решения:

1. Для того, чтобы уйти от ебенимуттерного call #3d2f, ввести доп. порт (порты), в которых
   можно рулить всякими ДОСЕНАми, открытостью теневых портов, режимом 4мб и прочими поебнями
   Предлагается $xxBF. Данный порт замечен ранее в дивИДЕ, которая в силу своей ущербности и
   невозможностью работы на любом спекоклоне с (НЕМО)ЗХ-БАС идет нахрен сразу и навсегда.
   Порт этот должен быть всегда открыт и доступен. Ибо см. выше про call #3d2f.

2. В этом порту разделить сигналы DOSEN (включение пзу трдос при помощи см. выше чего и выключение
   при помощи исполнения из ОЗУ) и сигнал включения теневых портов шедоуен (в том числе и ВГ93). ПРи
   этом, ессно, в отсутствии дрочки этого порта должен работать обычный механизьм с досен=шедоуен,
   залочкой досен по стандарту АТМ2 и проч.

3. Режим 4м должен реализоваться так: выводя в порты 3ff7/7ff7/bff7/fff7 - адресуемся в пределах 1 метра
   пзу или озу, как в атм1м. Выводя же в порты 37f7, 77f7, b7f7, f7f7 - включаем в соответствующее очко
   ОЗУ в пределах 4 мегабайт (тоже инверсные биты, ибо нефиг). 1м режимы адресуют страницы с номерами 00-3f,
   из всего набора 4м 00-фф. соотв-но чтобы 4м-адресацией адресануть страницу номер 00, выводим число ff
   (ибо инверсия).

4. На 2 карты памяти в режиме 4м предлагается забить болт.

5. В режиме пентагона есть порты xxФ7 (часы + порт ефф7) и хх77 (порт СД-карты, придуманный КОЕ-как).
   Оба они перекрываются атмными портами. Потому делаем тупо - пусть в пентагоновом режиме пентагоновы порты,
   а в атмном режиме - атмные. Как стучать в часы и сдкарту из атм - включая режим пятногона через ххБФ, видимо.
   Вариант - можно по сигналу шедоуен переключаться.

6. Интеграция с пент1м модой. Самое простое - опять же по шедоуен. Пока офф - работает ефф7 и 7ффд как в пентагоне,
   когда он - как в отме. При этом в момент переклюяения шедоуен никакие страницы внатуре не переключаются, остается
   всё как было. Карты памяти через бит 4 7ффд можно отключать в случае, если шедоуен выключен и в порте ефф7
   включен режим пент1м (или ОЗУ в 0 очко). Как следствие, для нормальной работы в 128к моде надо будет в
   биос/сервисе/пзу настроить карты памяти.
