Буду тут думать об том, как атм модес впихать в пентеву.
Поначалу речь пойдёт об манагере памяти и всём что с ним связано.

рассмотрим атм2.
Там применён оригинальный манагер памяти 1м, который позволяет флипать любую из 16к очек процессора.
Для совместимости с 128к моде было сделано следующее.
1 - добавлены 2 карты памяти, переключаемые с помощью бита из 7ффд, который раньше переключал пзухи
2 - сделан режим, когда младшие 3 бита номера страницы в данном очке могут подменяться на д0-д2 из 7ффд.
При помощи такой хуебени эмулируется обычная карта памяти 128к спека.
Сильная залочка на ДОСЕН и гадское трдос - я не понял например, можно ли без постоянной дрочки
ДОСЕН- не ДОСЕН вклчать любую страничку ПЗУ и работать с ней.

что требуется
1 - поддержать режим атм-компатибилити.
2 - расширить адресацию страниц озу до 4 метров
3 - интегрировать режим п1024к в атмо-режимы.



Волевые решения:

x. Для того, чтобы уйти от ебенимуттерного call #3d2f, ввести доп. порт (порты), в которых
   можно рулить всякими ДОСЕНАми, открытостью теневых портов, режимом 4мб и прочими поебнями
   Предлагается $xxBF. Данный порт замечен ранее в дивИДЕ, которая в силу своей ущербности и
   невозможностью работы на любом спекоклоне с (НЕМО)ЗХ-БАС идет нахрен сразу и навсегда.
   Порт этот должен быть всегда открыт и доступен. Ибо см. выше про call #3d2f.

x. В этом порту разделить сигналы DOSEN (включение пзу трдос при помощи см. выше чего и выключение
   при помощи исполнения из ОЗУ) и сигнал включения теневых портов шедоуен (в том числе и ВГ93). ПРи
   этом, ессно, в отсутствии дрочки этого порта должен работать обычный механизьм с досен=шедоуен,
   залочкой досен по стандарту АТМ2 и проч.

x. Режим 4м должен реализоваться так: выводя в порты 3ff7/7ff7/bff7/fff7 - адресуемся в пределах 1 метра
   пзу или озу, как в атм1м. Выводя же в порты 37f7, 77f7, b7f7, f7f7 - включаем в соответствующее очко
   ОЗУ в пределах 4 мегабайт (тоже инверсные биты, ибо нефиг). 1м режимы адресуют страницы с номерами 00-3f,
   из всего набора 4м 00-фф. соотв-но чтобы 4м-адресацией адресануть страницу номер 00, выводим число ff
   (ибо инверсия). В портах xFF7 D7 - определяет, впечатываются ли младшие биты из 7FFD. При записи в
   x7F7 этот бит сохраняется! т.е. адресуясь в 4 метрах, можно младшие биты из 7FFD втыкать, для чего надо
   вначале записать что-то в xFF7.

x. В режиме пентагона есть порты xxФ7 (часы + порт ефф7) и хх77 (порт СД-карты, придуманный КОЕ-как).
   Оба они перекрываются атмными портами. Потому делаем тупо - пусть в пентагоновом режиме пентагоновы порты,
   а в атмном режиме - атмные. Как стучать в часы и сдкарту из атм - включая режим пятногона через ххБФ, видимо.
   Вариант - можно по сигналу шедоуен переключаться.

x. Интеграция с п1м модой: вместо 3 бит в режиме п1м заменяются 6 бит. И всё. :)
   При этом все Очки работают штатно. Исключение - рам0 в 0 очкО - имеет приоритет над атм-стайл очком.

x. Следствием является то, что перед работой в режиме п1м надо настроить карты памяти. Или же сделать так,
   чтоб они дефолтно настраивались по сбросу (предпочтительнее).

xxBF:
 0 - shadowen control: 0 - shadowen=dosen, 1 - shadowen=1
 1 - ROMRW: 0 - ROM is read-only (no /WE), 1 - ROM is read-write (/WE)





==============================================================================
DDp (01.03.2010)

1) АТМ(2) для меня умер. Я хочу Пентагон с (линейным) текстовым режимом.  ;)

2) сигнал ROM2 активно используется в BIOS-е CP/M для быстрого переключения двух карт памяти
(при чём делается это через OUT (#FD),A  ,где A = #52, либо #42)
В xBIOS-е, вроде, тоже.

3) Вариант режима 4М: использовать доп. бит(ы) в ст.адресе порта F7.
Например,
запись в BFF7 программирует конфигурацию третьей четвертинки "по-старому";
запись в B7F7 устанавливает номер страницы ОЗУ, все 8 бит (можно без инверсии);
запись в BBF7 устанавливает номер страницы ПЗУ, все 8 бит (можно без инверсии).

4) Очертить круг TURBO2-программ, с которыми желательна совместимость и сделать всё чтобы они работали.
Если таких програм окажется немного - смотреть, можно ли их модифицировать для работы с другой(новой) архитектурой.
==============================================================================

