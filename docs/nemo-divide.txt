версия 1.0 17.08.2010

divide на портах nemo ide

Устройство позволяет использовать команды inir/otir, при этом оставаясь совместимым
с nemo ide.

Порты соответствуют старндартным портам nemo-ide:
+----+---------------------------+----------------------------+
|    |        in                 |        out                 |
+----+---------------------------+----------------------------+
|#11 | Регистр данных D8-D15     | Регистр данных D8-D15      |
|#10 | Регистр данных D0-D7      | Регистр данных D0-D7       |
|#30 | Регистр ошибок            | Регистр предкомпенсации (*)|
|#50 | Регистр счетчика секторов | Регистр счетчика секторов  |
|#70 | Регистр номера сектора    | Регистр номера сектора     |
|#90 | Регистр номера цилиндра   | Регистр номера цилиндра    |
|    |  (low)                    |  (low)                     |
|#B0 | Регистр номера цилиндра   | Регистр номера цилиндра    |
|    |  (high)                   |  (high)                    |
|#D0 | Регистр накопителя/головки| Регистр накопителя/головки |
|#F0 | Регистр состояния         | Регистр команд             |
+----+---------------------------+----------------------------+
|#C8 | Регистр альтернативного   | Управление состоянием нако-|
|    | состояния                 | пителя                     |
+----+---------------------------+----------------------------+

Использование в режиме nemo-ide (стандартный режим работы nemo-ide):
Запись:
загрузка значений в порты #30-D0 (параметры команды "запись секторов")
загрузка в порт #F0 кода команды "запись секторов"

цикл (n - число передаваемых слов)
{
загрузка старшего байта данных в порт #11 (данные записываются в скрытый регистр)
загрузка младшего байта данных в порт #10 (данные из скрытого регистра и с шины передаются в hdd)
}

Чтение:
загрузка значений в порты #30-D0 (параметры команды "чтение секторов")
загрузка в порт #F0 кода команды "чтение секторов"

цикл (n - число передаваемых слов)
{
чтение младшего байта данных из порта #10 (при этом старший байт защелкивается во внешнем регистре)
чтение старшего байта данных из порт #11 (чтение из скрытого регистра)
}

Использование в режиме divide:
При обращении (чтение/запись) к портам #30-#F0 происходит установка порта данных (#10) в режим приема/передачи
младшего байта. При каждой записи в порт #10 его режим автоматически переключается младший/старший. Триггеры режима
для записи и чтения должны быть независимыми, т.е. запись при записи в порт #10 а потом при чтении из него порт #10 должен
оставаться в режиме приема старшего байта (на запись со стороны компьютера).

Запись:
загрузка значений в порты #30-D0 (параметры команды "запись секторов")
загрузка в порт #F0 кода команды "запись секторов"

цикл (n - число передаваемых слов)
{
загрузка младшего байта данных в порт #10 (данные записываются в скрытый регистр)
загрузка старшего байта данных в порт #10 (данные из скрытого регистра и с шины передаются в hdd)
}

[вместо цикла можно использовать команду otir]

Чтение:
загрузка значений в порты #30-D0 (параметры команды "чтение секторов")
загрузка в порт #F0 кода команды "чтение секторов"

цикл (n - число передаваемых слов)
{
чтение младшего байта данных из порта #10 (при этом старший байт защелкивается во внешнем регистре)
чтение старшего байта данных из порт #10 (чтение из скрытого регистра)
}
[вместо цикла можно использовать команду inir]
