архитектура видеомодов.


1. выбиратор палитры. Работает сразу после инта (или как-то в начале экрана),
   выбирает в режиме 1/2, заполняя только первый ворд буфера. Из того буфера
   напрямую через муксы подключение к памяти палитры (и строб). Выбирает 256 слов,
   выборка длится 256/4*8=512 пикселей 7 МГц.
   
2. выбиратор даты на каждую строку. Должен начинать выборку в начале строки, режим - 1/2,
   выбирает весь буфер. После этого стробом дата копируется куда надо. Как вариант -
   выбирает только в первый ворд буфера, но стробов 4 (так даже предпочтительнее - 
   выбиратор всегда работает одинаково)

   формат даты для строки:
+0,w: [15:13] - строка в символе для текстового режима
      [12:0 ] - какая строка 512 байт (4 мегабайта памяти), прибавляется к предыдущему значению. Первая строка
                прибавляет к нулю. Для 64ц и 16ц - единственный указатель на строку, для текстмода -
				указатель на символы, для dpf - на первый плейн.

+2,w: [15:15] - если 1, то dual window mode для dpf режима
      [14:13] - видеомод для строки. Заодно часть указателя в палитру (страшие 2 байта 256 палитровых элементов)
      [12:11] - более младшие 2 бита [5:4] номера в палитру (для 16ц режима, для первого плейна dpf, для текстмода
                цвет текста)
      [10:8 ] - скролл влево (0..+7 влево), для первого плейна dpf и для остальных режимов. 
                Должен быть в пределах 0..1 для 64ц, 0..3 для dpf, 4..7 для текстмода (выборка стартует
                на 1 символ раньше), 0..1 для 16ц.
      [ 7:0 ] - начальный ворд в строке.

+4,w: [12:0 ] - какая строка 512 байт, аддитивно. Для текстового режима - откуда выбор атрибутов, второй плейн dpf.
                остальные моды - игнор.

+6,w: [12:11] - биты [5:4] номера в палитру (для второго плейна dpf, цвет пустого места для текстмода)
      [10:8 ] - скролл влево - только для второго плейна dpf, 0..3.
      [ 7:0 ] - начальный ворд в строке (второй плейн dpf, атрибуты текстового режима)


3. Адресный указатель для п.1 и п.2 общий, ресетится перед выборкой палитры.

4. Фетчер видеодаты строки. Стартует в обычном месте минус скролл влево (в единицах 7МГц).
   Работает в режиме 1/2 (все кроме текстмода) или 1/4 (текстмод). В текстмоде должен заполнять
   только половину буфера. Имеет 2 указателя, которые используются в dpf и текстмоде.
   указатели врапятся по 256 слов (512 байт) в режимах 64ц и 16ц 640х, по 128 слов (256 байт)
   в текстмоде и dpf.

5. рендерер. Рисует 64ц (с хамом?) или 16ц 640x или dpf или текстмод. Для dpf должен уметь
   обменивать потоки и задерживать один из них на 0..3 пикселя. Для dual window нужен счётчик
   до середины экрана (не скроллнутого!). Для текстмода фетч должен стартовать на символ раньше
   (и ещё раньше если скрлл влево) и код символа пропускаться через фонтпзу. В этом случае атрибуты
   будут по адресам +1 к тексту. В режиме 64ц -- формат байта: [5:0] - индекс в палитру,
   [7] - если 1, то удерживать предыдущий цвет (заданный последним байтом с [7]=0).

6. как юзается палитра в разных модах: по 64 на каждый мод. Тогда режим
   байт на точку - 64ц (2 бита свободны).

7. Старт выборки относительно левой границы видимого окна. В атм и zx-модах было -16, так как выборка
   происходила сильно заранее (из-за того, что в zx-режиме использовался режим 1/8 и надо было выбрать
   два ворда, а в атм и zx-16ц были хитровыебанные адресации и надо было выбрать много, прежде чем
   можно было начать рисовать). Нам необходимо -8 для всех режимов и еще -0..-7 левее.




