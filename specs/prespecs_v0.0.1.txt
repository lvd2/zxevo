v0.0.1, 10.08.2008, lvd: начальные сумбурные соображения



речь идёт о неком пентагоне, предлагаю кодовое название "pentagon evolution rev.A".
Или rev.AAA, если он в спонсоры заделается :)



Полный неклассифицированный сумбур


задание:

чтоб шли все демы и гамы как на обычном пентагоне, при наличии на плате
немоИДЕ, коеСД, пцклавы и пцмышки, жойстика и мех клавы, дисковода, ВГ93 и АУ,
слотов хзбас.

из вкусностей - возможна эмуляция практически любого клона, в т.ч. атм2,
возможность эволюционного развития (турбо14мгц без ваитов, 16ц без ваитов, более навороченные видеорежимы).

ГЛАВНАЯ ФИШКА - полностью ОТКРЫТАЯ архитектура (схемы, платы, прошивки всего и вся). привет КОЕ.



На плате:

микросхемы:

ep1k30 как главный герой
z80 - в корпусе ли ДИП или плцц?
статическая память на 1-2 мегабайта
флешка на 64-512 килобайт (плцц32)
слот под AY
слот под ВГ93 + выходные драйверы к155лн5 (всё через ФПГА)
atmega128 как эмулятор клавомышей и РТЦ, загрузчик ФПГА
pcf8583 - RTC (с батарейкой)
ics501 - синтезатор
палкодер онбоард


разъёмы:

видеовыход: RGB + две синхры (верт-гориз, или одна из них - композитная), выход палкодера (ПЦТС с возможностью ЧБ), 5в для скарта

отдельный видеовыход через тюльпан

выход звука: наплатный АУк + бит из порта FE

PS/2 две штуки (клава и мышь), подключены к atmege

вход джойстика (под амижный стандарт), подключён к атмеге

вход мех клавиатуры (40keys), подключен к атмеге

СДкарточка, подключена к фпга (по 'схеме' koeSD)

немоиде, к фпга

ZXBUS, 2-3 слота, к Z80 и fpga.

дисковод, к фпга+вг93, буферы к155лн5

РС232, через макс232 к атмеге

байтбластерный разъём, к фпга и к атмеге (цепочкой, если на атмежный ЖТАГ хватит ног у ней)

ещё один байтбластерный разъём, чтобы шить атмегу через SPI (MISO MOSI SCK /RESET XTAL1)


про архитектуру:

изначально стартует мега и грузит ФПГА. далее в процессе работы мега делает:

 - работает с пс/2 мышью и клавой, с мех. клавой и джойстиком, засылает образы портов в ФПГА через SPI
 - с помощью ФПГА и ваитов зетнику эмулирует РТЦ и РС232 кондратьевские (или ещё какие там)
 - управляет сбросом компа и перепрошивкой фпга

 - подключение к фпга:
      miso,mosi,sck, 2 штуки ЦСов, 2-3 провода на прерывания меги.
      mosi и sck дублируются на DCLK и DATA, или же отдельные 2 ноги ГПИО на дклк и дата
      nCONFIG, nSTATUS, CONF_DONE (нКОНФИГ обязательно, остальные в порядке убывания обязательности)

 - подключение к РТЦ: сигналы SDA, SCK (можно аппаратным I2C). ещё один провод (при наличии) на выход прерывания РТЦ

 - ПС/2 - клоки каждого интерфейса на входы прерывания МЕГИ (высокоприоритетные желательно), данные куда угодно.


фпга подключена:
к меге (см выше)
к немоиде (идеинтерфейс)
к РАМе отдельной шиной
к з80 всеми его сигналами
к сдкарточке
к сигналам выборки и т.д. ВГ93, АУ, флешки
к ВГ93 и дисководу (вся обвязка вг93 - в фпга)
к видеовыходу
к формирователю аудио (бипер)


ноги надо считать. В случае нехватик ног фпга разменивать их на рассыпуху и гемор:
 - в части немоиде (АП6 и ИР23)
 - в части меги (прерывания на мегу, 2 CS'a spi)
...вроде всё.




клоки:

мега на своём кварце 11.059мгц

ics501 с кварцем 14мгц выдаёт 56мгц (предусмотреть резисторы-'жамперы' для любого коэффа) на фпга

фпга выдаёт клок з80, который проходит через 74act04 и идёт взад в фпга на её другой клоковход и на З80.

фпга выдаёт клоки для АУ и для ВГ93 (через 74ацт04? в принципе вроде там 3.3в размаха хватает!)



связь фпга и меги:

SPI имеет 2 цса: соображения примерно такие, по одному ЦСу загружается адрес регистра, по другому - данные
пишутся или читаются из него, возможно с автоинкрементом

прерывания на мегу нужны для ваит-эмуляции для спектрума РТЦ и РС232.


можно предусмотреть возможность доступа для меги до СДкарточки...




